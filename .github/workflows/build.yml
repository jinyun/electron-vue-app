# 工作流的名称
name: Build and Release

# 触发工作流的事件
on:
  push:
    tags:
      - 'v*'  # 当推送到以 'v' 开头的分支时触发（例如 v1.0.0, v2.1.3）

# 定义要执行的作业
jobs:
  build:
    # 指定作业运行的操作系统
    runs-on: ${{ matrix.os }}
    # 使用矩阵策略来在多个操作系统上运行作业
    strategy:
      matrix:
        os: [macos-latest, ubuntu-latest, windows-latest]

    # 定义作业的步骤
    steps:
    # 检出代码
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
    
    # 设置 Node.js 环境
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'  # 指定 Node.js 版本

    # 安装项目依赖
    - name: Install dependencies
      run: npm ci  # 使用 clean install 以确保一致性

    # 为 macOS 构建  
    - name: Build for macOS
      if: matrix.os == 'macos-latest'  # 仅在 macOS 环境中运行
      run: npm run build:mac

    # 为 Windows 构建
    - name: Build for Windows
      if: matrix.os == 'windows-latest'  # 仅在 Windows 环境中运行
      run: npm run build:win

    # 为 Linux 构建 // 
    - name: Build for Linux
      if: matrix.os == 'ubuntu-latest'  # 仅在 Ubuntu（Linux）环境中运行
      run: npm run build:linux

    # 上传构建产物
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: EVA-${{ matrix.os }}-${{ github.ref_name }}  # 使用操作系统名称和分支名称来命名产物
        path: release/${{ github.ref_name }}  # 指定要上传的目录
